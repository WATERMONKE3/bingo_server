{% load static %}
<!DOCTYPE html>
<html>
<head>
    <title>Raffle Number Roller</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/seedrandom/3.0.5/seedrandom.min.js"></script>
    <link rel="stylesheet" href="{% static 'css/raffle.css'%}">
</head>
<body>
    <div id="numberRollerContainer">
        <div id="numberRoller">{{winner_number}}</div>
    </div>
    <button id="rollButton">Roll</button>
    <!-- Form to submit the winner number -->
    <form id="winnerForm" method="POST" action="{% url 'save_winner' %}">
        {% csrf_token %}
        <input type="hidden" name="winner_number" id="winnerNumberField">
    </form>
    <script>
        winnerForm = document.getElementById('winnerForm');
        winnerNumberField = document.getElementById('winnerNumberField');
        // Function to reshuffle and roll the numbers with seeded random
        function rollNumbers() {
            const numberRoller = document.getElementById('numberRoller');
            const rollButton = document.getElementById('rollButton');
            let ticketNumbers = {{ ticket_numbers|safe }}; // Load ticket numbers from the context

            // Generate a random seed based on the current time in seconds
            const seed = Math.floor(Date.now() / 1000);

            // Initialize the random number generator with the seed
            const seededRandom = new Math.seedrandom(seed);

            // Shuffle the ticketNumbers using the seeded random generator
            for (let i = ticketNumbers.length - 1; i > 0; i--) {
                const j = Math.floor(seededRandom() * (i + 1));
                [ticketNumbers[i], ticketNumbers[j]] = [ticketNumbers[j], ticketNumbers[i]];
            }

            // Disable the button temporarily to prevent multiple clicks
            rollButton.disabled = true;

            // Roll the numbers with animation for 3 seconds
            let currentIndex = 0;
            const startTime = Date.now();
            const rollDuration = 3000; // 3 seconds

            const interval = setInterval(function() {
                if (Date.now() - startTime < rollDuration) {
                    numberRoller.textContent = ticketNumbers[currentIndex];
                    currentIndex++;
                    if (currentIndex >= ticketNumbers.length) {
                        currentIndex = 0; // Loop back to the beginning
                    }
                } else {
                    clearInterval(interval);
                    // Display the final rolled number
                    numberRoller.textContent = ticketNumbers[ticketNumbers.length - 1];
                    // Set the winner number in the hidden field
                    winnerNumberField.value = ticketNumbers[ticketNumbers.length - 1];
                    // Submit the form
                    winnerForm.submit();
                }
            }, 100);
        }



        // Attach the rollNumbers function to the button's click event
        const rollButton = document.getElementById('rollButton');
        rollButton.addEventListener('click', rollNumbers);
    </script>
</body>
</html>
